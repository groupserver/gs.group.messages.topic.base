<form enctype="multipart/form-data"  method="post" action="."
  id="add-to-topic" tal:attributes="action request/URL"
  tal:define="allWidgets view/visibleWidgets">
  <h2>Post a reply</h2>
  <div id="gs-group-messages-topic-add-from" 
       tal:define="widget python:allWidgets[0]">
    <p class="muted">
      <span tal:define="width string:18; height string:24;"
            tal:replace="structure provider:groupserver.UserImage">
        &#9786;
      </span>
      Post as
      <strong tal:content="view/loggedInUser/name" class="fn">you</strong>
    </p>
    <span tal:condition="python:hasattr(widget, 'tag')"
          tal:replace="structure widget">Widget</span>
    <span class="readonlyWidget"
          tal:condition="python:not(hasattr(widget, 'tag'))"
          tal:content="structure widget"/>
  </div><!--gs-group-messages-topic-add-from-->

  <tal:block define="widgets python:allWidgets[1:]">
    <tal:block replace="structure provider:groupserver.FormWidgets"/>
  </tal:block>
  <div class="form-widget gs-group-messages-topic-add-file" 
    tal:define="widget python:view.widgets['uploadedFile'];"
    tal:attributes="id string:widget-${widget/name};">
    <label id="gs-group-messages-topic-add-file-label"
      for="abc123" title="The hint for the widget"
      tal:attributes="for widget/name; title widget/hint"
      tal:content="widget/label">
      A label
    </label>
    <div id="gs-group-messages-topic-add-file-files">
      <div id="gs-group-messages-topic-add-file-files-list">
        <span style="display:none;">&#160;</span>
      </div><!--gs-group-messages-topic-add-file-files-list-->
      <div class="gs-group-messages-topic-add-file-files-widget"
           tal:condition="python:hasattr(widget, 'tag')"
           tal:content="structure widget">
        Widget
      </div><!--gs-group-messages-topic-add-file-files-widget-->
    </div><!--gs-group-messages-topic-add-file-files-->
  </div><!--gs-group-messages-topic-add-file-->
  <tal:block repeat="widget view/hiddenWidgets">
    <span tal:replace="structure widget/hidden"/>
  </tal:block>
  <div class="buttons" tal:condition="view/availableActions">
    <span id="gs-group-messages-topic-add-privacy-summary"
          title="Privacy"
          tal:attributes="title string:Privacy: ${view/privacy/visibility};">
      <span class="muted">Post will be
      <span class="vis"
            tal:content="view/privacy/visibility">lurid</span></span>
      (?)
    </span>
    <div class="formelementbutton"
         tal:define="actions view/availableActions">
      <span 
        tal:replace="structure python:actions[0].render()">Button</span>
    </div>
  </div><!--buttons-->
  <div id="gs-group-messages-topic-add-privacy" style="display:none;"
       tal:content="structure provider:groupserver.PostPrivacy">
    Privacy statement
  </div><!--gs-group-messages-topic-add-privacy-->
</form><!--add-to-topic-->
