<html metal:use-macro="context/@@groupserver_layout/page">
  <head>
    <title metal:fill-slot="title">All posts in
      <span tal:define="retval view/update;"
        tal:replace="view/topicName">
        Standard Template for a Single Post
      </span>:
      <span tal:replace="view/groupInfo/name"/>:
      <span tal:replace="view/siteInfo/name"/>
    </title>
    <tal:block metal:fill-slot="metadata" 
      tal:define="topicName view/topicName">
      <link tal:condition="view/previousTopic/topicId" 
        rel="prev" title="Previous topic" href="wibble"
        tal:attributes="href view/previousTopic/topicId; 
        title string:Later topic: ${view/previousTopic/subject}" />
      <link tal:condition="view/nextTopic/topicId" 
        rel="next" title="earlier topic" href="wibble"
        tal:attributes="href view/nextTopic/topicId; 
        title string:Earlier topic: ${view/nextTopic/subject};" />
      <link rel="up" title="All topics" href="../topics.html"
        tal:attributes="title string:Topics in ${view/groupInfo/name};"/>
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title string:${view/groupInfo/name} Homepage;
        href view/groupInfo/url" />
      <link rel="home" 
        tal:attributes="title string:${view/siteInfo/name} Homepage;
        href view/siteInfo/url" />
      <link rel="help" 
        tal:attributes="title string:${view/siteInfo/name} Help;
        href string:${view/siteInfo/url}/help" />
      <meta name="description"
            tal:attributes="content python:view.topic[0]['summary']" />
    </tal:block>
  </head>
  
  <body>
    <tal:block content="structure provider:groupserver.FormStatusMessage"
      define="errors view/errors; status view/status; widgets view/widgets"
      metal:fill-slot="messages">&#160;</tal:block>
    <div class="hfeed" metal:fill-slot="body"
      tal:define="topicList view/topic"
      tal:condition="topicList">
      <h1>All posts in the topic
        <cite tal:content="view/topicName">This Topic</cite>
      </h1>
      <form tal:condition="view/userIsAdmin"
        class="adminTasks" id="toggleStickyTopic"
        enctype="multipart/form-data"  method="post" action="."
        tal:attributes="action request/URL">
        <tal:block define="widgets python:[view.widgets['sticky']]">
          <tal:block replace="structure provider:groupserver.FormWidgets"/>
        </tal:block>
        <div class="buttons" tal:condition="view/availableActions">
          <div class="formelementbutton">
            <tal:block
              replace="structure python:view.availableActions()[1].render()">
              Button
            </tal:block>
          </div>
        </div><!--buttons-->
      </form><!--toggleStickyTopic-->
      <ul id="topicNav" class="navlinks inline-list">
        <li>
          <span tal:condition="not:view/previousTopic/topicId"
             class="prev">No later topic</span>
          <a href="#" class="prev"
            tal:condition="view/previousTopic/topicId"
            tal:attributes="href view/previousTopic/topicId;
              title view/previousTopic/subject;">Later topic</a></li>
        <li>
          <a class="topics up"
            tal:attributes="title string:Topics in ${view/groupInfo/name}"
            href="../topics.html">All Topics</a></li>
        <li>
          <span tal:condition="not:view/nextTopic/topicId"
            class="next">No earlier topic</span>
          <a href="#" class="next"
            tal:condition="view/nextTopic/topicId" 
            tal:attributes="href view/nextTopic/topicId;
              title view/nextTopic/subject;">Earlier topic</a></li>
      </ul><!--topicNav-->

      <div tal:define="topic topicList"
        tal:replace="structure provider:groupserver.TopicSummary"/>
        
      <div class="share-bar" 
        tal:define="topicName view/topicName;
          lastPostId python:topicList[-1]['post_id']"
        tal:attributes="title string:${topicName};
         public python:view.isPublic and 1 or 0;
         href string:${view/siteInfo/url}/r/topic/${lastPostId}">
         &#160;
       </div><!--share-bar-->

      <div class="postList">
        <tal:block repeat="post topicList">
          <p tal:define="position repeat/post/number;
            rptAuth python:topicList[position-1]['author_id'] == topicList[position-2]['author_id'];
            showPhoto python:(position==1) or not(rptAuth);
            isPublic view/isPublic"
            tal:replace="structure provider:groupserver.Post">
            The email message is rendered by the Post content provider,
            not by this page.
          </p>
        </tal:block>
      </div><!--postList-->

      <ul id="bottom-topic-nav" class="navlinks inline-list">
        <li>
          <span tal:condition="not:view/previousTopic/topicId"
             class="prev">No later topic</span>
          <a href="#" class="prev"
            tal:condition="view/previousTopic/topicId"
            tal:attributes="href view/previousTopic/topicId;
              title view/previousTopic/subject;">Later topic</a></li>
        <li>
          <a class="topics up"
            tal:attributes="title string:Topics in ${view/groupInfo/name}"
            href="../topics.html">All Topics</a></li>
        <li>
          <span tal:condition="not:view/nextTopic/topicId"
            class="next">No earlier topic</span>
          <a href="#" class="next"
            tal:condition="view/nextTopic/topicId" 
            tal:attributes="href view/nextTopic/topicId;
              title view/nextTopic/subject;">Earlier topic</a></li>
      </ul><!--bottom-topic-nav-->

      <form tal:condition="view/userPostingInfo/canPost"
        enctype="multipart/form-data"  method="post" action="."
        id="add-to-topic" tal:attributes="action request/URL">
        <h2>Add to the topic
          <cite class="topic" 
            tal:content="view/topicName">topicName</cite></h2>
        <tal:block define="widgets python:[view.widgets['fromAddress'], view.widgets['message']]">
          <tal:block replace="structure provider:groupserver.FormWidgets"/>
        </tal:block>

        <div class="form-widget" id="widget-file-upload" 
          tal:define="widget python:view.widgets['uploadedFile'];"
          tal:attributes="id string:widget-${widget/name};">
          <label for="abc123" title="The hint for the widget"
            tal:attributes="for widget/name; title widget/hint"
            tal:content="widget/label">
            A label
          </label>
          <div id="fileList"><span style="display:none;">&#160;</span></div>
          <span
            tal:condition="python:hasattr(widget, 'tag')"
            tal:replace="structure widget">Widget</span>
        </div><!--widget-file-upload-->
        
        <tal:block repeat="widget python:[view.widgets['inReplyTo']]">
          <span tal:replace="structure widget/hidden"/>
        </tal:block>
        
        <p tal:replace="structure provider:groupserver.PostPrivacy">
          Privacy statement
        </p>
        <div class="buttons" tal:condition="view/availableActions">
          <div class="formelementbutton">
            <span 
              tal:replace="structure python:view.availableActions()[0].render()">Button</span>
          </div>
        </div><!--buttons-->
      </form><!--add-to-topic-->
      <p class="message-result"
        tal:condition="not:view/userPostingInfo/canPost"
        tal:define="statusNum view/userPostingInfo/statusNum;
          status view/userPostingInfo/status;"
        tal:content="structure provider:groupserver.UserCanPost" />
    </div><!--hfeed-->
    <tal:block metal:fill-slot="javascript">
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.form.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.MetaData.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.MultiFile.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.blockUI.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++gsfileupload-20090622.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++popup_help-20071218.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++sharebox-20100721.js">&#160;</script>
      <script type="text/javascript">
        jQuery.noConflict();
        jQuery(document).ready( function () {
          GSPopupFormHelp.init('#add-to-topic');
          GSFileUpload.init();
        });
      </script>
    </tal:block>
  </body>
</html>

