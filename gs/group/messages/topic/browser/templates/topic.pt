<html metal:use-macro="context/@@groupserver_layout/page">
  <head>
    <title metal:fill-slot="title">
      <span tal:define="retval view/update;"
        tal:replace="view/topicName">
        Standard Template for a Single Post
      </span>:
      <span tal:replace="view/groupInfo/name"/>:
      <span tal:replace="view/siteInfo/name"/>
    </title>
    <tal:block metal:fill-slot="metadata" 
      tal:define="topicName view/topicName">
      <tal:block 
        define="previousTopic view/previousTopic; 
          nextTopic view/nextTopic;
          pageTemplateFileName string:browser/templates/navlinksmeta.pt"
        replace="structure provider:groupserver.TopicNavLinks">
        Navigation links
      </tal:block>
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title string:${view/groupInfo/name} Homepage;
        href view/groupInfo/url" />
      <link rel="home" 
        tal:attributes="title string:${view/siteInfo/name} Homepage;
        href view/siteInfo/url" />
      <link rel="help" 
        tal:attributes="title string:${view/siteInfo/name} Help;
        href string:${view/siteInfo/url}/help" />
      <meta name="description"
            tal:attributes="content python:view.topic[0]['summary']" />
    </tal:block>
  </head>
  
  <body>
    <tal:block content="structure provider:groupserver.FormStatusMessage"
      define="errors view/errors; status view/status; widgets view/widgets"
      metal:fill-slot="messages">&#160;</tal:block>
    <div class="hfeed" metal:fill-slot="body"
      tal:define="topicList view/topic"
      tal:condition="topicList">
      <h1><cite tal:content="view/topicName">This Topic</cite></h1>
      <tal:block 
        define="previousTopic view/previousTopic; 
          nextTopic view/nextTopic"
        replace="structure provider:groupserver.TopicNavLinks">
        Navigation links
      </tal:block>
      <form tal:condition="view/userIsAdmin"
        class="adminTasks" id="toggleStickyTopic"
        enctype="multipart/form-data"  method="post" action="."
        tal:attributes="action request/URL">
        <tal:block define="widgets python:[view.widgets['sticky']]">
          <tal:block replace="structure provider:groupserver.FormWidgets"/>
        </tal:block>
        <div class="buttons" tal:condition="view/availableActions">
          <div class="formelementbutton">
            <tal:block
              replace="structure python:view.availableActions()[1].render()">
              Button
            </tal:block>
          </div>
        </div><!--buttons-->
      </form><!--toggleStickyTopic-->
      <div tal:define="topic topicList"
        tal:replace="structure provider:groupserver.TopicSummary">
        Topic Summary
      </div>
      <div class="share-bar" 
        tal:define="topicName view/topicName;
          lastPostId python:topicList[-1]['post_id']"
        tal:attributes="title string:${topicName};
         public python:view.isPublic and 1 or 0;
         href string:${view/siteInfo/url}/r/topic/${lastPostId}">
         &#160;
       </div><!--share-bar-->
      <div class="postList">
        <tal:block repeat="post topicList">
          <p tal:define="position repeat/post/number;
            rptAuth python:topicList[position-1]['author_id'] == topicList[position-2]['author_id'];
            showPhoto python:(position==1) or not(rptAuth);
            isPublic view/isPublic"
            tal:replace="structure provider:groupserver.Post">
            The email message is rendered by the Post content provider.
          </p>
        </tal:block>
      </div><!--postList-->
      <tal:block 
        define="previousTopic view/previousTopic; 
          nextTopic view/nextTopic"
        replace="structure provider:groupserver.TopicNavLinks">
        Navigation links
      </tal:block>
      <div id="hide-the-post" title="Hide the Post">
        <p class="loading">Loadingâ€¦</p>
      </div><!--hide-the-post-->
      <form tal:condition="view/userPostingInfo/canPost"
        enctype="multipart/form-data"  method="post" action="."
        id="add-to-topic" tal:attributes="action request/URL">
        <h2>Add to the topic
          <cite class="topic" 
            tal:content="view/topicName">topicName</cite></h2>
        <tal:block define="widgets python:[view.widgets['fromAddress'], view.widgets['message']]">
          <tal:block replace="structure provider:groupserver.FormWidgets"/>
        </tal:block>
        <div class="form-widget" id="widget-file-upload" 
          tal:define="widget python:view.widgets['uploadedFile'];"
          tal:attributes="id string:widget-${widget/name};">
          <label for="abc123" title="The hint for the widget"
            tal:attributes="for widget/name; title widget/hint"
            tal:content="widget/label">
            A label
          </label>
          <div id="fileList"><span style="display:none;">&#160;</span></div>
          <span
            tal:condition="python:hasattr(widget, 'tag')"
            tal:replace="structure widget">Widget</span>
        </div><!--widget-file-upload-->
        <tal:block repeat="widget python:[view.widgets['inReplyTo']]">
          <span tal:replace="structure widget/hidden"/>
        </tal:block>
        <p tal:replace="structure provider:groupserver.PostPrivacy">
          Privacy statement
        </p>
        <div class="buttons" tal:condition="view/availableActions">
          <div class="formelementbutton">
            <span 
              tal:replace="structure python:view.availableActions()[0].render()">Button</span>
          </div>
        </div><!--buttons-->
      </form><!--add-to-topic-->
      <p class="message-result"
        tal:condition="not:view/userPostingInfo/canPost"
        tal:define="statusNum view/userPostingInfo/statusNum;
          status view/userPostingInfo/status;"
        tal:content="structure provider:groupserver.UserCanPost" />
    </div><!--hfeed-->
    <tal:block metal:fill-slot="javascript">
      <script type="text/javascript"
        src="/++resource++hide-post-20110415.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.form.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.MetaData.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.MultiFile.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++multiple_file_upload/jquery.blockUI.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++gsfileupload-20090622.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++popup_help-20071218.js">&#160;</script>
      <script type="text/javascript"
        src="/++resource++sharebox-20100721.js">&#160;</script>
      <script type="text/javascript">
        jQuery.noConflict();
        jQuery(document).ready( function () {
          GSPopupFormHelp.init('#add-to-topic');
          GSFileUpload.init();
        });
      </script>
    </tal:block>
  </body>
</html>

